/*
 * Written by Wayfarer@Portals
 * special functions for generating vt100 character sequences
 *
 * Adjusted by Watcher to make it more termcapish and to use ansi.h
 *
 * WARNING: Do not edit this file with ed!  It will lose its magical 
 * powers and be reduced to messages that look like " [7m" because ed
 * tends to strip out escape characters!
 */

#include <ansi.h>

// add by Kyoko, for set color in mud.
// now only define 14 color can be set, don't let background color
// be set will be better, defined colors are:
// RED ºì GRN ÂÌ YEL »Æ BLU À¶ MAG ·Ûºì CYN µ­À¶
// HIR    HIG    HIY    HIB    HIM      HIC -> ¼ÓÁÁ
static string *colors = ({ "HIW", "HIC", "HIB", "HIG", "HIY", "HIM", "HIR",
		"WHT", "CYN", "BLU", "GRN", "YEL", "MAG", "RED", "NOR", });
static string *color_code = ({ HIW, HIC, HIB, HIG, HIY, HIM, HIR,
		WHT, CYN, BLU, GRN, YEL, MAG, RED, NOR, });

varargs string set_color(mixed str, string color, object player)
{
	int i;
	string flag;

	if( !str ) return "";
	if( !color ) return str+"";
	if( !player ) player = this_player();
	if( !player ) return str+"";
	if( !flag=player->getenv("vt100") ) return str+"";
	i = member_array(color, colors);
	if( i == -1 ) return str+"";
	if( flag == "mono" )
		return i>7 ? (U + str + NOR) : str+"";
	else
		return (color_code[i] + str + NOR);
}

varargs string inverse(string str, object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return str;
	return (REV + str + NOR);
}

varargs string blink(string str, object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return str;
	return (BLINK + str + NOR);
}

varargs string bold(string str, object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return str;
	return (BOLD + str + NOR);
}

varargs string underscore(string str, object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return str;
	return (U + str + NOR);
}

varargs string clear_screen(object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return ""; 
	return (CLR);
}

varargs string clear_line(object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return "";
	return (CSI + "2K");
}

varargs string up_line(object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return "";
	return (CSI + "A"); 
}

varargs string erase_line(object player)
{
	if( !player ) player = this_player();
	if( !player->getenv("vt100") ) return "\n";
	return (clear_line(player) + CSI + "79D");
}
